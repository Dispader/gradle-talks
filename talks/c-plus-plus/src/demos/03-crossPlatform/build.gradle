apply plugin: 'cpp-lib'
apply plugin: 'cpp'

cpp {
    sourceSets {
        test {
            lib libraries.main.shared
        }
    }
}

binaries.withType(NativeBinary) {
    if (toolChain == compilers.visualCpp) {
        compilerArgs '/Zi', '/RTC1'
        linkerArgs '/DEBUG'
    } else {
        compilerArgs '-g'
    }
}

libraries {
    main {
        binaries.withType(SharedLibraryBinary) {
            define 'DLL_EXPORT'
        }
    }
}

executables {
    test {
        source cpp.sourceSets.test
    }
}

afterEvaluate {
	task test(type: Exec, dependsOn: installTestExecutable) {
		commandLine "${installTestExecutable.destinationDir}/test"
	}
}
